<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Pivotal Search</title>
  <meta name="description" content="">
  <meta name="author" content="">
  <!-- HTML5 shim, for IE6-8 support of HTML elements -->
  <!--[if lt IE 9]>
  <script src="http://apps.bdimg.com/libs/html5shiv/r29/html5.min.js"></script>
  <![endif]-->
  <!-- styles -->
  <link href="stylesheets/style.css" rel="stylesheet" type="text/css">
  <!--  <link rel="stylesheet" type="text/css" href="http://unpkg.com/iview/dist/styles/iview.css">-->
  <!--  <script type="text/javascript" src="http://vuejs.org/js/vue.min.js"></script>-->
  <!--  <script type="text/javascript" src="http://unpkg.com/iview/dist/iview.min.js"></script>-->
  <link rel="stylesheet" type="text/css" href="stylesheets/iview.css">
  <script type="text/javascript" src="javascripts/vue.min.js"></script>
  <script type="text/javascript" src="javascripts/iview.min.js"></script>
  <script type="text/javascript" src="javascripts/axios.min.js"></script>
  <style>
    #input-all {
      width: 600px;
      height: 250px;
      border: 1px solid rebeccapurple;
      position: relative;
      margin: 0 auto;
      margin-top: 100px;
    }

    .input-form {
      padding-top: 20px;

    }

    .input-button {
      width: 100px;
      display: table;
      margin: 0 auto;
      margin-top: 20px;
    }
  </style>
</head>

<body>

<!-- <div id="app" style="background-image: url(./images/bg.jpg);"> -->
<div id="app">
  <div id="ceil">
    <ul>
      <li style="float:left;padding-left: 30px"><a href="#about">关于</a></li>
      <!--        <li><a class="active" href="#home">主页</a></li>-->
      <li>
        <i-button @click="register">注册</i-button>
      </li>
      <li>
        <i-button @click="login">登录</i-button>
      </li>
      <!--        <li><a href="#contact">联系</a></li>-->
    </ul>
  </div>
  <div id="table-container">
    <i-table :columns="columns" :data="data">
      <template slot-scope="{ row, index }" slot="phid">
        <span>{{ row.phid }}</span>
      </template>

      <template slot-scope="{ row, index }" slot="long_link">
        <span>{{ row.long_link }}</span>
      </template>
<!--      短链接自定义-->
      <template slot-scope="{ row, index }" slot="short_link">
        <Input type="text" v-model="editShortLink" v-if="editIndex === index" />
        <span v-else>{{ row.short_link }}</span>
      </template>

      <template slot-scope="{ row, index }" slot="inserted_at">
        <span>{{ row.inserted_at }}</span>
      </template>

      <template slot-scope="{ row, index }" slot="updated_at">
        <span>{{ row.updated_at }}</span>
      </template>

      <template slot-scope="{ row, index }" slot="action">
        <div v-if="editIndex === index">
          <i-button @click="handleSave(index)">保存</i-button>
          <i-button @click="editIndex = -1">取消</i-button>
        </div>
        <div v-else>
          <i-button @click="handleEdit(row, index)">操作</i-button>
        </div>
      </template>
    </i-table>
  </div>
</div>

<script>
  new Vue({
    el: '#app',
    data() {
      return {
        columns: [
          {
            title: 'phid',
            slot: 'phid'
          },
          {
            title: '原链接',
            slot: 'long_link'
          },
          {
            title: '短链接',
            slot: 'short_link'
          },
          {
            title: '生成时间',
            slot: 'inserted_at'
          },
          {
            title: '更新时间',
            slot: 'updated_at'
          },
          {
            title: '操作',
            slot: 'action'
          }
        ],
        data: [],
        editIndex: -1,  // 当前聚焦的输入框的行数
        editShortLink: '',  // 第一列输入框，当然聚焦的输入框的输入内容，与 data 分离避免重构的闪烁
      }
    },
    created(){
      this.getList();
    },
    methods: {
      login() {
        window.location.href = '/login'
      },
      register() {
        window.location.href = '/register'
      },
      handleEdit (row, index) {
        this.editShortLink = row.short_link;
        this.editIndex = index;
      },
      handleSave (index) {
        this.data[index].short_link = this.editShortLink;
        this.editIndex = -1;
      },
      getBirthday (birthday) {
        const date = new Date(parseInt(birthday));
        const year = date.getFullYear();
        const month = date.getMonth() + 1;
        const day = date.getDate();
        return `${year}-${month}-${day}`;
      },
      handleSubmit(name) {
        //校验密码是否输入正确
        let pw = this.formInline.password
        let repw = this.formInline.repassword
        if (pw !== repw) {
          this.$Message.error({
            title: '提示',
            content: '两次密码输入不一致，请重新输入',
          })
          return;
        }

        var self = this
        axios.post('/register', {
          user: self.formInline.user,
          password: self.formInline.password
        })
            .then(function (response) {
              let data = response.data
              self.data = data.data;

            })
            .catch(function (error) {
              console.log(error)
            })
            .then(function () {
              // always executed
            })
      },
      getList(){
        let self = this;
        axios.get('/su/getList')
            .then(function (response) {
              let data = response.data
              self.data = data.data;

            })
            .catch(function (error) {
              console.log(error)
            })
            .then(function () {
              // always executed
            })
      }
    }
  })
</script>
</body>

</html>
